Imports System.Data.SqlClient
Imports System.IO
Public Class Form_EDIT
    'متغيرات اضافة صور
    Dim ImageFile As Image
    Dim ImageFilePath As String
    Dim sFilePath As String
    Dim imgHeight As Integer
    Dim imgWidth As Integer
    Dim imgType As String
    Dim img As Byte()
    ' متغيرات رقم المنتج
    Public intrand As Object
    Public intstep As Object
    Public strname As Object
    Public intnamelength As Object
    Public intlength As Object
    Public strlnputstring As Object

    Dim pagingAdapter As SqlDataAdapter
    Dim pagingDS As DataSet
    ReadOnly scrollVal As Integer
    Private Sub FIND_TextChanged(ByVal sender As System.Object, ByVal e As EventArgs) Handles FIND.TextChanged
        If FIND.Text.Trim = "" Then
            DataEE.Columns.Clear()
            Co1.Text = ""
            Te2.Text = ""
            Te3.Text = ""
            Te4.Text = ""
            TexNU.Text = ""
            M7.Text = ""
            Pic1.Image = Nothing
            LabED.Text = ""
            Exit Sub
        End If
        If Radio1.Checked = False And Radio2.Checked = False Then
            MsgBox(" حدد خيارات البحث", MsgBoxStyle.Exclamation, "تنبيه")
            Exit Sub
        End If
        If ComC.Text.Trim = "اختر طريقة التعديل" Or ComC.Text.Trim = "" Then
            MsgBox("اختر طريقة التعديل", MsgBoxStyle.Exclamation, "تنبيه")
            Exit Sub
        End If
        Dim Consum As New SqlConnection(constring)
        If ComC.Text = "تعديل سلع البيع" Then
            If Radio1.Checked = True Then
                If Consum.State = ConnectionState.Open Then
                    Consum.Close()
                End If
                Consum.Open()
                'البيانات بالتدريج                                                                             WHERE CUser ='" & CUser & "'  and SKITM4 like'" & Trim(FIND.Text) & "%'" & "or SKITM5 like'" & Trim(FIND.Text) & "%'"                                                           
                Dim sql As String = "SELECT SKITM1, SKITM3, SKITM4, SKITM5, SKITM8, SKITM9, SKITM12, SKITM14, SKITM15, SKITM16, SKITM17, SKITM20, SKITM21  FROM  STOCKSITEMS where SKITM3 LIKE '%" & FIND.Text.Trim & "%' "
                pagingAdapter = New SqlDataAdapter(sql, Consum)
                pagingDS = New DataSet()
                pagingAdapter.Fill(pagingDS, scrollVal, 35, "STOCKSITEMS")
                Consum.Close()
                DataEE.DataSource = pagingDS
                DataEE.DataMember = "STOCKSITEMS"
                DataEE.Sort(DataEE.Columns(0), System.ComponentModel.ListSortDirection.Ascending)
            ElseIf Radio2.Checked = True Then
                If Consum.State = ConnectionState.Open Then
                    Consum.Close()
                End If
                Consum.Open()
                Dim sql As String = "SELECT SKITM1, SKITM3, SKITM4, SKITM5, SKITM8, SKITM9, SKITM12, SKITM14, SKITM15, SKITM16, SKITM17, SKITM20, SKITM21  FROM  STOCKSITEMS WHERE CUser ='" & CUser & "'  and SKITM4 like'" & Trim(FIND.Text) & "%'" & "or SKITM5 like'" & Trim(FIND.Text) & "%'"
                pagingAdapter = New SqlDataAdapter(sql, Consum)
                pagingDS = New DataSet()
                pagingAdapter.Fill(pagingDS, scrollVal, 35, "STOCKSITEMS")
                Consum.Close()
                DataEE.DataSource = pagingDS
                DataEE.DataMember = "STOCKSITEMS"
                DataEE.Sort(DataEE.Columns(0), System.ComponentModel.ListSortDirection.Ascending)
            End If

            Dim unused As New DataGridViewRow

            Dim dgvRow As DataGridViewRow
            For Each dgvRow In DataEE.Rows
                If dgvRow.Index Mod 2 = 0 Then
                    DataEE.Rows(dgvRow.Index).DefaultCellStyle.BackColor = Color.LightYellow
                End If
            Next
            DataEE.Columns(0).HeaderText = "رقم المعرف"
            DataEE.Columns(1).HeaderText = "مجموعة الصنف"
            DataEE.Columns(2).HeaderText = "كود الصنف"
            DataEE.Columns(3).HeaderText = "اسم الصنف"
            DataEE.Columns(4).HeaderText = "سعر الصنف"
            DataEE.Columns(5).HeaderText = "خصم الصنف"
            DataEE.Columns(6).HeaderText = "ضريبةالمبيعات"
            DataEE.Columns(7).HeaderText = "سعر البيع"
            DataEE.Columns(8).HeaderText = "خصم عند البيع"
            DataEE.Columns(9).HeaderText = "اقل نسبة خصم"
            DataEE.Columns(10).HeaderText = "اعلى نسبة خصم"
            DataEE.Columns(11).HeaderText = "تشمل ضريبةالمبيعات"
            DataEE.Columns(12).HeaderText = "يخضع لضريبةالمبيعات"
            PurchasingEnquiry()

            Dim unused1 As New DataGridViewRow

            Dim dvRow1 As DataGridViewRow
            For Each dvRow1 In DataGridView1.Rows
                If dvRow1.Index Mod 2 = 0 Then
                    DataGridView1.Rows(dvRow1.Index).DefaultCellStyle.BackColor = Color.LightYellow
                End If
            Next
            DataGridView1.Columns(0).HeaderText = "رقم المعرف"
            DataGridView1.Columns(1).HeaderText = "اسم الصنف"
            DataGridView1.Columns(2).HeaderText = "كود الصنف"
            DataGridView1.Columns(3).HeaderText = "سعر الصنف"
            DataGridView1.Columns(4).HeaderText = "خصم الصنف"
            DataGridView1.Columns(5).HeaderText = "سعر البيع"
            DataGridView1.Columns(6).HeaderText = "رقم الفاتورة"
            Exit Sub
        ElseIf ComC.Text = "تعديل سلع الوقت المحسوب" Then
            If Radio1.Checked = True Then
                If Consum.State = ConnectionState.Open Then
                    Consum.Close()
                End If
                Consum.Open()
                Dim sql As String = "SELECT *  FROM  STOCKSITEMS where SKITM4 LIKE '%" & FIND.Text.Trim & "%' "
                pagingAdapter = New SqlDataAdapter(sql, Consum)
                pagingDS = New DataSet()
                pagingAdapter.Fill(pagingDS, scrollVal, 35, "STOCKSITEMS")
                Consum.Close()
                DataEE.DataSource = pagingDS
                DataEE.DataMember = "STOCKSITEMS"
                DataEE.Sort(DataEE.Columns(0), System.ComponentModel.ListSortDirection.Ascending)
            ElseIf Radio2.Checked = True Then
                If Consum.State = ConnectionState.Open Then
                    Consum.Close()
                End If
                Consum.Open()
                Dim sql As String = "SELECT ID,AS0,AS1,AS2,AS3,AS4,AS5,IMGS  FROM  SALATIME where AS0 LIKE '%" & FIND.Text.Trim & "%' "
                pagingAdapter = New SqlDataAdapter(sql, Consum)
                pagingDS = New DataSet()
                pagingAdapter.Fill(pagingDS, scrollVal, 35, "SALATIME")
                Consum.Close()
                DataEE.DataSource = pagingDS
                DataEE.DataMember = "SALATIME"
                DataEE.Sort(DataEE.Columns(0), System.ComponentModel.ListSortDirection.Ascending)
            End If

            Dim unused2 As New DataGridViewRow

            Dim dgvRow As DataGridViewRow
            For Each dgvRow In DataEE.Rows
                If dgvRow.Index Mod 2 = 0 Then
                    DataEE.Rows(dgvRow.Index).DefaultCellStyle.BackColor = Color.LightYellow
                End If
            Next
            DataEE.Columns(0).HeaderText = "رقم المعرف"
            DataEE.Columns(1).HeaderText = "نوع الصنف"
            DataEE.Columns(2).HeaderText = "اسم الصنف"
            DataEE.Columns(3).HeaderText = "بداية الوقت"
            DataEE.Columns(4).HeaderText = "نهاية الوقت"
            DataEE.Columns(5).HeaderText = "سعر الصنف"
            DataEE.Columns(6).HeaderText = "رقم الصنف"
            DataEE.Columns(7).HeaderText = "صورة الصنف"
        End If
    End Sub

    Private Sub DataEE_CellClick(ByVal sender As Object, ByVal e As DataGridViewCellEventArgs) Handles DataEE.CellClick
        On Error Resume Next
        If ComC.Text = "تعديل سلع البيع" Then
            LabED.Text = DataEE(0, e.RowIndex).Value
            Co1.Text = DataEE(1, e.RowIndex).Value
            TexNU.Text = DataEE(2, e.RowIndex).Value
            Te2.Text = DataEE(3, e.RowIndex).Value
            Te3.Text = DataEE(4, e.RowIndex).Value
            Te4.Text = DataEE(5, e.RowIndex).Value
            TextSalesTaxRate.Text = DataEE(6, e.RowIndex).Value
            TextTexTSellingPrice.Text = DataEE(7, e.RowIndex).Value
            TextDiscountPercentageWhenSelling.Text = DataEE(8, e.RowIndex).Value
            TextLowestDiscountRateWhenSelling.Text = DataEE(9, e.RowIndex).Value
            TextHighestDiscountRateWhenSelling.Text = DataEE(10, e.RowIndex).Value
            CheckPricesMentionedIncludeSalesTax.Checked = DataEE(11, e.RowIndex).Value
            CheckItemIsSubjectToSalesTax.Checked = DataEE(12, e.RowIndex).Value
            'استعراض الصورة
            If Consum.State = ConnectionState.Closed = False Then Consum.Close()
            Consum.Open()
            Pic1.Image = Nothing
            Dim dtp As New SqlDataAdapter("select * from STOCKSITEMS where IMGNAME = '" & TexNU.Text.Trim & "'", Consum)
            Dim ds As New DataSet
            dtp.Fill(ds, "STOCKSITEMS")
            If ds.Tables("STOCKSITEMS").Rows.Count > 0 Then
                Pic1.DataBindings.Clear()
                Pic1.DataBindings.Add("image", ds.Tables("STOCKSITEMS"), "IMGS", True)
            End If

        End If

    End Sub
    Private Sub DataGridView1_CellClick(ByVal sender As Object, ByVal e As DataGridViewCellEventArgs) Handles DataGridView1.CellClick
        On Error Resume Next
        If ComC.Text = "تعديل سلع البيع" Then
            LabED.Text = DataEE(0, e.RowIndex).Value
            Te2.Text = DataGridView1(1, e.RowIndex).Value
            TexNU.Text = DataGridView1(2, e.RowIndex).Value
            Te3.Text = DataGridView1(3, e.RowIndex).Value
            Te4.Text = DataGridView1(4, e.RowIndex).Value
            TextTexTSellingPrice.Text = DataGridView1(5, e.RowIndex).Value
            'استعراض الصورة
        End If
    End Sub

    Private Sub ButDE_Click(ByVal sender As System.Object, ByVal e As EventArgs) Handles ButDE.Click

        If TestNet = False Then
            MsgBox("الاتصال بالانترنت غير متوفر", 16, "تنبيه")
            Exit Sub
        End If
        If LockDelete = False Then
            MsgBox("عفوا .. قام الأدمن بمنع خاصية مراجعة السجلات من البرنامج", 16, "تنبيه")
            Exit Sub
        End If
        If Co1.Text.Trim = "" Then
            MsgBox("اختر نوع الصنف ", MsgBoxStyle.Critical)
            Exit Sub
        End If
        Try
            Dim Consum As New SqlConnection(constring)
            If Consum.State = ConnectionState.Open Then
                Consum.Close()
            End If

            Dim deleteok As String = MsgBox("هل ترغب بحذف البيانات المحددة ", MsgBoxStyle.Question + MsgBoxStyle.YesNo, "تأكيد عملية حذف البيانات")
            If deleteok = vbYes Then
                Dim cmd As New SqlCommand("delete from STOCKSITEMS where SKITM1=@SKITM1", Consum)
                cmd.Parameters.AddWithValue("@SKITM1", LabED.Text.Trim)

                Consum.Open()
                cmd.ExecuteNonQuery()
                Consum.Close()
                MsgBox("تم الحذف", MsgBoxStyle.Exclamation, "عملية الحذف")
                Insert_Actions(LabED.Text, "حذف بيانات الصنف", Me.Text)
                Try
                    If Consum.State = ConnectionState.Open Then
                        Consum.Close()
                    End If
                    Dim cmd056 As New SqlCommand("insert into Porseccc (Noamlea,Timee,Datad,valueD) values  (@Noamlea,@Timee,@Datad,@valueD)", Consum)
                    cmd056.Parameters.AddWithValue("@Noamlea", TexNU.Text.Trim & "-" & "حذف سلعة مبيعات" & "-" & USERNAME)
                    cmd056.Parameters.AddWithValue("@Timee", Now.ToString("hh:mm:ss tt"))
                    cmd056.Parameters.AddWithValue("@Datad", Now.ToString("dd/MM/yyyy"))
                    cmd056.Parameters.AddWithValue("@valueD", Te3.Text.Trim)
                    Consum.Open()
                    cmd056.ExecuteNonQuery()
                    Consum.Close()
                Catch ex As Exception
                    MsgBox(ex.Message)
                End Try

                LabED.Text = ""
            ElseIf deleteok = vbNo Then
                Exit Sub
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try

        DataEE.Columns.Clear()
        Co1.Text = ""
        Te2.Text = ""
        Te3.Text = ""
        Te4.Text = ""
        TexNU.Text = ""
        Pic1.Image = Nothing
        LabED.Text = ""
        M7.Text = ""

    End Sub


    Private Sub ButAA_Click(ByVal sender As System.Object, ByVal e As EventArgs) Handles ButAA.Click
        '=====================================================================================
        'رقم المنتج
        strlnputstring = "946564126535615326241565642353261235326412356642653613562315665235466524363221356223415662435656235466523546213565235456282043653898373898373653535898378983736535353627282993930393837664535343434957544389837365353536272829939303938376645353434348983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293458983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453689837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495722372839030495625366736873986453623728390304985098249572408572435728457234752439875234875082347529345562536673687398645362372839030493294628204989837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049575443329958372920495556377383949958575659484746353526474849404098385757773464626627987635242526373898373653535362728299393039383766453534343485098249589837389837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030497240898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498572435728457234752439875289837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875236538983738983736535358983789837365353536272829939303938376645353434343487508234752934556253667368739864536237898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536289837365353589837898378983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249572898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957289837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495728983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249572898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957289837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495728983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249572898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957289837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495723653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495727282993930393837664535343434850982495722839030498983736535353627282993930393837664535343434850982495723487508 " & _
            "23475293455625366736873986453623728390304948474635353637383904034049529562356356356898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493673596825923098374646222345094584574995837294628204957544332995837292049555637738394995857565948474635352647484940409838575777346462662798763898373653535362728299393039383766453534343485098249572408572435728457234752439889837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368898373653535362728299393039383766453534343485098249578983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957257224085724357284572347524398752348750823475293455625366736873986453623728390304973986453623789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049283903049752348750823475293455625366736873986453623728390304952898373653535898378983736535353627282993930393837663653898373898373653535898378983736535353627282993930393837664535343434453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030489837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372889837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495723903049898373653535362728299393039383766453534343485098249572989837365353536272829939303938376645353434348509824957242526373" & _
"898365389837389833653898373898373653535898378983736535353627282993930393837664535343434736535358983789837365353536272829939303938376645353434343736535358983898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536289837365353589837898373653535362728299393039383766453534343485098249572408572465465465485646465466666666666666444444444444444444444444444444888888888885456446546546546545646546546546548421324654654564654654654654875132165487865432132165464414654655466543245746749744514214346545942145142124454515415433649754541242424154544464245421241542421512424542121215454412452543543654654325434656543299999999999999999999999999999999999999999999999999999999999999999999999999999777777777777777777777777777777777145852572675572572572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495789837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495722728299393039383766453534343485098249572898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353538983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249572627282993930393837664535343434853653898373898373653535898378983736535353627282993930393837664535343434098249572789837365353536272829939303938376645353434348509824957240857248983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249572898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957289837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495728983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249572898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957235728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936272829898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030499393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839089837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049304948474635353637383904034049529562356356356367359682592309837464622234509458457492049555637738389837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495729499585756594847463535264748494040983857577734646266279876352428983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304952898983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390389837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049049837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049637389837" & _
"365389837389837365353589837898373653535362725464543216543216546546555555555555555555555555566546534452653465642653546265356426535642653564265346285356423556465235467283567235765235462535164523546728536782935642653546235166523546235748635768299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495728983736535358983789837365353536272829939303938376645353434348509365389837389837365353589837898373653535362728299393039383766453534343482495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957265353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049589889837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752938983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304945562536673687398645362372839030493736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304935362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030494847494628204957544332995837292049555637738394995857565948474635352647484940409838575777346462662798763524252637389837365389837365353536272829939303938376645353434348509824953653898373898373653535898378983736535353627282993930393837664535343434723653898373898373653535898378983736535353627282993930393837664535343434408572435728457234752439875234875082347529345562536673687398645898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957236237283903049535362728299393039383766453589837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049343434850982495724085724357284572347524398752348983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986458983736535353627282898373653535362728299393039383766453534343485098249572408572435728457234752439875234898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498750823475293455625366736873986453623728390304999393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493623728390304987508234752934" & _
"556253667368733653898373898373653535898378983736535353627282993930393837664535343434365389837389837365353589837898373653535362728299393039383766453534343436538983738983736535358983789837365353536272829939303938376645353434343653898373898373653535898378983736535353627282993930393837664535343434365389837389837365353589837898373653535362728299393039383766453534343436538983738983736535358983789837365353536272829939303938376645353365389837389837365353589837898373653535362728299393039383766453534343436538983738983736535358983789837365353536272829939303938376645353434343653898373898373653535898378983736535353627282993930393837664535343434365389837389837365353589837898373653535362728299393039383766453534343436538983738983736535358983789837365353536272829939303938376645353434343653898373898373653535898378983736535353627282993930393837664535343434365389837389837365353589837898373653535362728299393039383766453534343436538983738983736535358983789837365353536272829939303938376645353434343653898373898373653535898378983736535353627282993930393837664535343434365389837389837365353589837898373653535362728299393039383766453534343436538983738983736535358983789837365353536272829939303938376645353434343653898373898373653535898378983736535353627282993930393837664535343434365389837389837365353589837898373653535362728299393039383766453534343436538983738983736535358983789837365353536272829939303938376645353434343653898373898373653535898378983653898373898373653535898378983736535353627282993930393653898373898373653535898378983736535353627282993930393837664535343434383766453534343437365353536272829939303938376645353434344343498898373653535898378983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304936535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304989837365353536272829939303938376645353434348509824957264536237283903049484746353536373839040340495295623563563563673598983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304968259230983746462223450945845746353536373839040340495295689837365353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495722356356356898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493673596825923098374623563563563673596826235635635623563898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030898373658983736535358983789837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049898373653535362728299393039383766453534343485098249572353589837898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030493653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030498983736535353627282993930393837664535343434850982495724956356367359898373653535362728299393039383766453534343485098249572408572435728457234752439875234875082347529345562536673687398645362372839030496826235635635636735968263673596826235623563563563673596826356356367359682646222345096235635623563563563673596826356367359682462356356356367359682584578983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455628983736535353627282993930393837664535343434850982495724085724357284589837365353536272829939303938376645353434348509824957240857243572845723475243987523487508234752934556253667368739864536237283903049723475243987523487508234752934556253667368739864536237283903049536673687398645362372839030498983736535353627282993930393837664535343434850982495724085724357284572347524398752348750823475293455625366736873986453623728390304943"
        intlength = Len(strlnputstring)
        intnamelength = 6
        Randomize()
        strname = "000"
        Dim intstep As Integer
        For intstep = 1 To intnamelength
            intrand = Int(intlength * Rnd()) + 1
            strname &= Mid(strlnputstring, intrand, 1)
        Next
        TexNU.Text = strname
    End Sub

    Private Sub Butbro_Click(ByVal sender As System.Object, ByVal e As EventArgs) Handles Butbro.Click
        Try
            OpenFileDialog_img.Title = "Set Image File"
            OpenFileDialog_img.Filter = "Images (*.PNG;*.BMP;*.JPG;*.GIF)|*.PNG;*.BMP;*.JPG;*.GIF|" & "All files (*.*)|*.*"
            OpenFileDialog_img.DefaultExt = "JPEG"
            OpenFileDialog_img.FilterIndex = 1
            OpenFileDialog_img.FileName = ""
            If OpenFileDialog_img.ShowDialog = Windows.Forms.DialogResult.OK Then
                sFilePath = OpenFileDialog_img.FileName
                If System.IO.File.Exists(sFilePath) = False Then
                    Exit Sub
                Else
                    Me.M7.Text = sFilePath
                    ImageFilePath = sFilePath
                    Try
                        Dim fs As New FileStream(ImageFilePath.ToString(), FileMode.Open)
                        img = New Byte(fs.Length) {}
                        fs.Read(img, 0, fs.Length)
                        fs.Close()
                    Catch ex As Exception
                        MsgBox(ex.ToString)
                    End Try
                    ImageFile = Image.FromFile(ImageFilePath.ToString())
                    imgHeight = ImageFile.Height
                    imgWidth = ImageFile.Width
                    imgType = Path.GetExtension(ImageFilePath)
                    Pic1.Image = Image.FromFile(sFilePath)
                End If
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub ButtEDE_Click(ByVal sender As System.Object, ByVal e As EventArgs) Handles ButtEDE.Click
        If TestNet = False Then
            MsgBox("الاتصال بالانترنت غير متوفر", 16, "تنبيه")
            Exit Sub
        End If
        If LockUpdate = False Then
            MsgBox("عفوا .. قام الأدمن بمنع خاصية مراجعة السجلات من البرنامج", 16, "تنبيه")
            Exit Sub
        End If
        If Co1.Text.Trim = "" Then
            MsgBox("اختر نوع الصنف ", MsgBoxStyle.Critical)
            Exit Sub
        End If
        Try
            Dim Consum As New SqlConnection(constring)
            Dim EDITOK As String = MsgBox("هل أنت متأكد من تعديل بيانات الصنف  " & Environment.NewLine & Te2.Text.Trim, MsgBoxStyle.Question + MsgBoxStyle.YesNo, "تأكيد عملية تعديل البيانات")
            If EDITOK = vbYes Then
                If Consum.State = ConnectionState.Open Then
                    Consum.Close()
                End If
                Consum.Open()
                Dim cmd As New SqlCommand("update STOCKSITEMS set SKITM3=@SKITM3,SKITM4=@SKITM4 ,SKITM5=@SKITM5,SKITM8=@SKITM8,SKITM9=@SKITM9,SKITM12=@SKITM12,SKITM14=@SKITM14,SKITM15=@SKITM15,SKITM16=@SKITM16,SKITM17=@SKITM17,SKITM20=@SKITM20,SKITM21=@SKITM21, USERNAME = @USERNAME, CUser = @CUser, COUser = @COUser   where SKITM1=@SKITM1", Consum)
                cmd.Parameters.AddWithValue("@SKITM1", LabED.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM3", Co1.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM4", TexNU.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM5", Te2.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM8", Te3.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM9", Te4.Text.Trim) '

                cmd.Parameters.AddWithValue("@SKITM12", TextSalesTaxRate.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM14", TextTexTSellingPrice.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM15", TextDiscountPercentageWhenSelling.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM16", TextLowestDiscountRateWhenSelling.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM17", TextHighestDiscountRateWhenSelling.Text.Trim) '
                cmd.Parameters.AddWithValue("@SKITM20", Convert.ToInt32(CheckPricesMentionedIncludeSalesTax.Checked)) '
                cmd.Parameters.AddWithValue("@SKITM21", Convert.ToInt32(CheckItemIsSubjectToSalesTax.Checked)) '
                cmd.Parameters.AddWithValue("@USERNAME", USERNAME)
                cmd.Parameters.AddWithValue("@CUser", CUser)
                cmd.Parameters.AddWithValue("@COUser", COUser)
                'cmd.Parameters.AddWithValue("@da", ServerDateTime.ToString("yyyy-MM-dd"))
                'cmd.Parameters.AddWithValue("@ne", ServerDateTime.ToString("hh:mm:ss tt"))
                'cmd.Parameters.AddWithValue("@da1", ServerDateTime.ToString("yyyy-MM-dd"))
                'cmd.Parameters.AddWithValue("@ne1", ServerDateTime.ToString("hh:mm:ss tt"))

                cmd.ExecuteNonQuery()
                Consum.Close()
                MsgBox("تمت عملية الحفظ في قاعدة البيانات بنجاح", 64 + 524288, "نجاح الحفظ والتغييرات والتحديث")
                'كود ادخال صورة المنتج , USERNAME = @USERNAME, CUser = @CUser, COUser = @COUser , da = @da, ne = @ne, da1 = @da1, ne1 = @ne1
            End If
        Catch ex As Exception
            MsgBox(ex.Message & "مشكلة في عملة التعديل", MsgBoxStyle.Critical)
        End Try
        Insert_Actions(LabED.Text, "تعديل بيانات الصنف", Me.Text)
    End Sub

    Private Sub Form_EDIT_Load(ByVal sender As System.Object, ByVal e As EventArgs) Handles MyBase.Load
        On Error Resume Next
        Me.BackgroundImage = ModuleGeneral.img
        For a As Byte = 0 To 10
            System.Threading.Thread.Sleep(10)
            Application.DoEvents()
            Me.Opacity = a / 10
        Next
        Call MangUsers()
        FILLCOMBOBOX1("STOCKSITEMS", "SKITM3", "CUser", CUser, Me.Co1)
    End Sub
    Private Sub PurchasingEnquiry()
        Dim Consum As New SqlConnection(constring)
        Dim str1 As New SqlCommand("", Consum)
        With str1
            .CommandText = "SELECT DISTINCT BITM1,BITM3,BITM4,BITM5,BITM7,BITM9,BUY2 FROM BUYSITEMS WHERE  BUY2 ='" & Me.TextInvoiceNumber.Text & "'"
            If Consum.State = ConnectionState.Open Then Consum.Close()
            Consum.Open()
            Dim ds As New DataSet
            Dim dt As New DataTable
            Dim Adp1 As New SqlDataAdapter(str1)
            On Error Resume Next
            ds.Clear()
            Adp1.Fill(ds, "BUYSITEMS")
            Adp1.Fill(dt)
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "BUYSITEMS"
        End With
    End Sub

End Class